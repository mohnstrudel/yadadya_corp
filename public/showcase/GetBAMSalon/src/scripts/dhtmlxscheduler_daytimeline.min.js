!function(){var a=scheduler.createTimelineView;scheduler.createTimelineView=function(k){function D(){var g=new Date(scheduler.getState().date),d=scheduler.date[E+"_start"](g);d=scheduler.date.date_part(d);var c=[],f=scheduler.matrix[E];f.y_unit=c,f.order={};for(var h=0;h<k.days;h++){c.push({key:+d,label:d}),f.order[f.y_unit[h].key]=h,d=scheduler.date.add(d,1,"day")}}function J(f){var d={};for(var c in f){d[c]=f[c]}return d}function q(d,c){c.setFullYear(d.getFullYear()),c.setMonth(d.getMonth()),c.setDate(d.getDate())}function A(p){for(var g=[],f=0;f<p.length;f++){var d=H(p[f]);if(scheduler.isOneDayEvent(d)){z(d),g.push(d)}else{for(var o=new Date(Math.min(+d.end_date,+scheduler._max_date)),r=new Date(Math.max(+d.start_date,+scheduler._min_date)),c=[];+o>+r;){var m=H(d);m.start_date=r,m.end_date=new Date(Math.min(+K(m.start_date),+o)),r=K(r),z(m),g.push(m),c.push(m)}w(c,d)}}return g}function w(l,f){for(var d=!1,c=!1,g=0,m=l.length;m>g;g++){var h=l[g];d=+h._w_start_date==+f.start_date,c=+h._w_end_date==+f.end_date,h._no_resize_start=h._no_resize_end=!0,d&&(h._no_resize_start=!1),c&&(h._no_resize_end=!1)}}function H(d){var c=scheduler.getEvent(d.event_pid);return c&&c.isPrototypeOf(d)?(d=scheduler._copy_event(d),delete d.event_length,delete d.event_pid,delete d.rec_pattern,delete d.rec_type):d=scheduler._lame_clone(d),d}function z(h){if(!h._w_start_date||!h._w_end_date){var f=scheduler.date,d=h._w_start_date=new Date(h.start_date),c=h._w_end_date=new Date(h.end_date);h[I]=+f.date_part(h.start_date),h._count||(h._count=1),h._sorder||(h._sorder=0);var g=c-d;h.start_date=new Date(scheduler._min_date),C(d,h.start_date),h.end_date=new Date(+h.start_date+g)}}function C(d,c){c.setMinutes(d.getMinutes()),c.setHours(d.getHours())}function K(d){var c=scheduler.date.add(d,1,"day");return c=scheduler.date.date_part(c)}if("days"!=k.render){return void a.apply(this,arguments)}var E=k.name,I=k.y_property="timeline-week"+E;k.y_unit=[],k.render="bar",k.days=k.days||7,a.call(this,k),scheduler.templates[E+"_scalex_class"]=function(){},scheduler.templates[E+"_scaley_class"]=function(){},scheduler.templates[E+"_scale_label"]=function(d,c){return scheduler.templates.day_date(c)},scheduler.date[E+"_start"]=function(c){return c=scheduler.date.week_start(c),c=scheduler.date.add(c,k.x_step*k.x_start,k.x_unit)},scheduler.date["add_"+E]=function(d,c){return scheduler.date.add(d,c*k.days,"day")};var j=scheduler._renderMatrix;scheduler._renderMatrix=function(c){c&&D(),j.apply(this,arguments)};var e=scheduler.checkCollision;scheduler.checkCollision=function(c){if(c[I]){var c=J(c);delete c[I]}return e.apply(scheduler,[c])},scheduler.attachEvent("onBeforeDrag",function(h,f,d){var c=d.target||d.srcElement,g=c.className||"";if("resize"==f){scheduler._w_line_drag_from_start=g.indexOf("dhx_event_resize_end")<0?!0:!1}else{if("move"==f&&g.indexOf("no_drag_move")>=0){return !1}}return !0});var G=scheduler["mouse_"+E];scheduler["mouse_"+E]=function(m){var L;if(this._drag_event&&(L=this._drag_event._move_delta),void 0===L&&"move"==scheduler._drag_mode){var l=scheduler.matrix[this._mode],v={y:m.y};scheduler._resolve_timeline_section(l,v);var M=m.x-l.dx,h=new Date(v.section);C(scheduler._timeline_drag_date(l,M),h);var f=scheduler._drag_event,p=this.getEvent(this._drag_id);f._move_delta=(p.start_date-h)/60000,this.config.preserve_length&&m._ignores&&(f._move_delta=this._get_real_event_length(p.start_date,h,l),f._event_length=this._get_real_event_length(p.start_date,p.end_date,l))}var m=G.apply(scheduler,arguments);if(scheduler._drag_mode&&"move"!=scheduler._drag_mode){var g=null;g=new Date(scheduler._drag_event&&scheduler._drag_event["timeline-week"+E]?scheduler._drag_event["timeline-week"+E]:m.section),m.y+=Math.round((g-scheduler.date.date_part(new Date(scheduler._min_date)))/(60000*this.config.time_step)),"resize"==scheduler._drag_mode&&(m.resize_from_start=scheduler._w_line_drag_from_start)}else{if(scheduler._drag_event){var x=Math.floor(Math.abs(m.y/(1440/scheduler.config.time_step)));x*=m.y>0?1:-1,m.y=m.y%(1440/scheduler.config.time_step);var u=scheduler.date.date_part(new Date(scheduler._min_date));u.valueOf()!=new Date(m.section).valueOf()&&(m.x=Math.floor((m.section-u)/86400000),m.x+=x)}}return m},scheduler.attachEvent("onEventCreated",function(c){return scheduler._events[c]&&delete scheduler._events[c][I],!0}),scheduler.attachEvent("onBeforeEventChanged",function(c){return scheduler._events[c.id]&&delete scheduler._events[c.id][I],!0});var F=scheduler.render_view_data;scheduler.render_view_data=function(d,c){return this._mode==E&&d&&(d=A(d)),F.apply(scheduler,[d,c])};var B=scheduler.get_visible_events;scheduler.get_visible_events=function(){if(this._mode==E){scheduler._max_date=scheduler.date.date_part(scheduler.date.add(scheduler._min_date,k.days,"day"));var c=B.apply(scheduler,arguments);return A(c)}return B.apply(scheduler,arguments)};var y=scheduler.addEventNow;scheduler.addEventNow=function(f){if(scheduler.getState().mode==E){if(f[I]){var d=new Date(f[I]);q(d,f.start_date),q(d,f.end_date)}else{var c=new Date(f.start_date);f[I]=+scheduler.date.date_part(c)}}return y.apply(scheduler,arguments)};var b=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(){return scheduler._mode!=E?b.apply(this,arguments):void 0}}}();
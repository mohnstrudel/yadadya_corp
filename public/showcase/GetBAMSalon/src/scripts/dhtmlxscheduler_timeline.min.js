Scheduler.plugin(function(a){a._temp_matrix_scope=function(){function F(){for(var f=a.get_visible_events(),c=[],h=0;h<this.y_unit.length;h++){c[h]=[]}c[d]||(c[d]=[]);for(var h=0;h<f.length;h++){for(var d=this.order[f[h][this.y_property]],g=0;this._trace_x[g+1]&&f[h].start_date>=this._trace_x[g+1];){g++}for(;this._trace_x[g]&&f[h].end_date>this._trace_x[g];){c[d][g]||(c[d][g]=[]),c[d][g].push(f[h]),g++}}return c}function B(M,K,p){var v=0,f=p._step,N=p.round_position,I=0,L=K?M.end_date:M.start_date;L.valueOf()>a._max_date.valueOf()&&(L=a._max_date);var g=L-a._min_date_timeline;if(g>0){var u=a._get_date_index(p,L);a._ignores[u]&&(N=!0);for(var J=0;u>J;J++){v+=a._cols[J]}var H=a.date.add(a._min_date_timeline,a.matrix[a._mode].x_step*u,a.matrix[a._mode].x_unit);N?+L>+H&&K&&(I=a._cols[u]):(g=L-H,p.first_hour||p.last_hour?(g-=p._start_correction,0>g&&(g=0),I=Math.round(g/f),I>a._cols[u]&&(I=a._cols[u])):I=Math.round(g/f))}return v+=K?0===g||N?I-14:I-12:I+1}function k(f,c){var g=a._get_date_index(this,f),d=this._trace_x[g];return c&&+f!=+this._trace_x[g]&&(d=this._trace_x[g+1]?this._trace_x[g+1]:a.date.add(this._trace_x[g],this.x_step,this.x_unit)),new Date(d)}function q(J){var W="";if(J&&"cell"!=this.render){J.sort(this.sort||function(d,c){return d.start_date.valueOf()==c.start_date.valueOf()?d.id>c.id?1:-1:d.start_date>c.start_date?1:-1});for(var Q=[],L=J.length,K=0;L>K;K++){var U=J[K];U._inner=!1;var X=this.round_position?k.apply(this,[U.start_date,!1]):U.start_date;for(this.round_position?k.apply(this,[U.end_date,!0]):U.end_date;Q.length;){var N=Q[Q.length-1];if(!(N.end_date.valueOf()<=X.valueOf())){break}Q.splice(Q.length-1,1)}for(var P=!1,V=0;V<Q.length;V++){var R=Q[V];if(R.end_date.valueOf()<=X.valueOf()){P=!0,U._sorder=R._sorder,Q.splice(V,1),U._inner=!0;break}}if(Q.length&&(Q[Q.length-1]._inner=!0),!P){if(Q.length){if(Q.length<=Q[Q.length-1]._sorder){if(Q[Q.length-1]._sorder){for(var I=0;I<Q.length;I++){for(var H=!1,T=0;T<Q.length;T++){if(Q[T]._sorder==I){H=!0;break}}if(!H){U._sorder=I;break}}}else{U._sorder=0}U._inner=!0}else{for(var S=Q[0]._sorder,M=1;M<Q.length;M++){Q[M]._sorder>S&&(S=Q[M]._sorder)}U._sorder=S+1,U._inner=!1}}else{U._sorder=0}}Q.push(U),Q.length>(Q.max_count||0)?(Q.max_count=Q.length,U._count=Q.length):U._count=U._count?U._count:1}for(var O=0;O<J.length;O++){J[O]._count=Q.max_count}for(var n=0;L>n;n++){W+=a.render_timeline_event.call(this,J[n],!1)}}return W}function b(af){var V="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",S=[];if(a._load_mode&&a._load(),"cell"==this.render){S=F.call(this)}else{for(var Q=a.get_visible_events(),ac=this.order,ag=0;ag<Q.length;ag++){var U=Q[ag],X=U[this.y_property],ad=this.order[X];if(this.show_unassigned&&!X){for(var Z in ac){if(ac.hasOwnProperty(Z)){ad=ac[Z],S[ad]||(S[ad]=[]);var L=a._lame_copy({},U);L[this.y_property]=Z,S[ad].push(L)}}}else{S[ad]||(S[ad]=[]),S[ad].push(U)}}}for(var K=0,ab=0;ab<a._cols.length;ab++){K+=a._cols[ab]}var aa=new Date,T=a._cols.length-a._ignores_detected;aa=(a.date.add(aa,this.x_step*T,this.x_unit)-aa-(this._start_correction+this._end_correction)*T)/K,this._step=aa,this._summ=K;var W=a._colsS.heights=[],H=[];this._events_height={},this._section_height={};for(var ab=0;ab<this.y_unit.length;ab++){var I=this._logic(this.render,this.y_unit[ab],this);a._merge(I,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*I.height<af.offsetHeight&&(I.height=Math.max(I.height,Math.floor((af.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[ab].key]=I.height),I.td_className||(I.td_className="dhx_matrix_scell"+(a.templates[this.name+"_scaley_class"](this.y_unit[ab].key,this.y_unit[ab].label,this.y_unit[ab])?" "+a.templates[this.name+"_scaley_class"](this.y_unit[ab].key,this.y_unit[ab].label,this.y_unit[ab]):"")),I.td_content||(I.td_content=a.templates[this.name+"_scale_label"](this.y_unit[ab].key,this.y_unit[ab].label,this.y_unit[ab])),a._merge(I,{tr_className:"",style_height:"height:"+I.height+"px;",style_width:"width:"+(this.dx-1)+"px;",summ_width:"width:"+K+"px;",table_className:""});var ae=q.call(this,S[ab]);if(this.fit_events){var J=this._events_height[this.y_unit[ab].key]||0;I.height=J>I.height?J:I.height,I.style_height="height:"+I.height+"px;",this._section_height[this.y_unit[ab].key]=I.height}if(V+="<tr class='"+I.tr_className+"' style='"+I.style_height+"'><td class='"+I.td_className+"' style='"+I.style_width+" height:"+(I.height-1)+"px;'>"+I.td_content+"</td>","cell"==this.render){for(var ag=0;ag<a._cols.length;ag++){V+=a._ignores[ag]?"<td></td>":"<td class='dhx_matrix_cell "+a.templates[this.name+"_cell_class"](S[ab][ag],this._trace_x[ag],this.y_unit[ab])+"' style='width:"+(a._cols[ag]-1)+"px'><div style='width:"+(a._cols[ag]-1)+"px'>"+a.templates[this.name+"_cell_value"](S[ab][ag],this._trace_x[ag],this.y_unit[ab])+"</div></td>"}}else{V+="<td><div style='"+I.summ_width+" "+I.style_height+" position:relative;' class='dhx_matrix_line'>",V+=ae,V+="<table class='"+I.table_className+"' cellpadding='0' cellspacing='0' style='"+I.summ_width+" "+I.style_height+"' >";for(var ag=0;ag<a._cols.length;ag++){V+=a._ignores[ag]?"<td></td>":"<td class='dhx_matrix_cell "+a.templates[this.name+"_cell_class"](S[ab],this._trace_x[ag],this.y_unit[ab])+"' style='width:"+(a._cols[ag]-1)+"px'><div style='width:"+(a._cols[ag]-1)+"px'></div></td>"}V+="</table>",V+="</div></td>"}V+="</tr>",H.push(I)}V+="</table>",this._matrix=S,af.innerHTML=V,a._rendered=[];for(var Y=a._obj.getElementsByTagName("DIV"),ab=0;ab<Y.length;ab++){Y[ab].getAttribute("event_id")&&a._rendered.push(Y[ab])}this._scales={};for(var O=af.firstChild.rows,P=null,ab=0,i=H.length;i>ab;ab++){P=this.y_unit[ab],W.push(H[ab].height);var t=P.key,R=this._scales[t]=a._isRender("cell")?O[ab]:O[ab].childNodes[1].getElementsByTagName("div")[0];a.callEvent("onScaleAdd",[R,t])}}function G(f){var c=a._min_date,h=a._max_date;a._process_ignores(c,this.x_size,this.x_unit,this.x_step,f);for(var d=(this.x_size+(f?a._ignores_detected:0),0),g=0;+h>+c;){if(this._trace_x[g]=new Date(c),c=a.date.add(c,this.x_step,this.x_unit),a.date[this.x_unit+"_start"]&&(c=a.date[this.x_unit+"_start"](c)),a._ignores[g]||d++,g++,f){if(d<this.x_size&&!(+h>+c)){h=a.date["add_"+this.name+"_private"](h,(this.x_length||this.x_size)*this.x_step)}else{if(d>=this.x_size){a._max_date=c;break}}}}return{total:g,displayed:d}}function z(W){var ao=a.xy.scale_height,ad=this._header_resized||a.xy.scale_height;a._cols=[],a._colsS={height:0},this._trace_x=[];var ah=a._x-this.dx-a.xy.scroll_width,Z=[this.dx],al=a._els.dhx_cal_header[0];al.style.width=Z[0]+ah+"px";for(var ac=a._min_date_timeline=a._min_date,af=a.config.preserve_scale_length,am=G.call(this,af),ai=am.displayed,U=am.total,ak=0;U>ak;ak++){a._ignores[ak]?(a._cols[ak]=0,ai++):a._cols[ak]=Math.floor(ah/(ai-ak)),ah-=a._cols[ak],Z[ak+1]=Z[ak]+a._cols[ak]}if(W.innerHTML="<div></div>",this.second_scale){for(var aj=this.second_scale.x_unit,ab=[this._trace_x[0]],ae=[],P=[this.dx,this.dx],Q=0,an=0;an<this._trace_x.length;an++){var R=this._trace_x[an],ag=D(aj,R,ab[Q]);ag&&(++Q,ab[Q]=R,P[Q+1]=P[Q]);var V=Q+1;ae[Q]=a._cols[an]+(ae[Q]||0),P[V]+=a._cols[an]}W.innerHTML="<div></div><div></div>";var X=W.firstChild;X.style.height=ad+"px";var I=W.lastChild;I.style.position="relative";for(var J=0;J<ab.length;J++){var Y=ab[J],H=a.templates[this.name+"_second_scalex_class"](Y),K=document.createElement("DIV");K.className="dhx_scale_bar dhx_second_scale_bar"+(H?" "+H:""),a.set_xy(K,ae[J]-1,ad-3,P[J],0),K.innerHTML=a.templates[this.name+"_second_scale_date"](Y),X.appendChild(K)}}a.xy.scale_height=ad,W=W.lastChild;for(var s=0;s<this._trace_x.length;s++){if(!a._ignores[s]){ac=this._trace_x[s],a._render_x_header(s,Z[s],ac,W);var u=a.templates[this.name+"_scalex_class"](ac);u&&(W.lastChild.className+=" "+u)}}a.xy.scale_height=ao;var aa=this._trace_x;W.onclick=function(d){var c=E(d);c&&a.callEvent("onXScaleClick",[c.x,aa[c.x],d||event])},W.ondblclick=function(d){var c=E(d);c&&a.callEvent("onXScaleDblClick",[c.x,aa[c.x],d||event])}}function D(d,c,f){switch(d){case"hour":return c.getHours()!=f.getHours()||D("day",c,f);case"day":return !(c.getDate()==f.getDate()&&c.getMonth()==f.getMonth()&&c.getFullYear()==f.getFullYear());case"week":return !(a.date.getISOWeek(c)==a.date.getISOWeek(f)&&c.getFullYear()==f.getFullYear());case"month":return !(c.getMonth()==f.getMonth()&&c.getFullYear()==f.getFullYear());case"year":return !(c.getFullYear()==f.getFullYear());default:return !1}}function j(d){if(d){a.set_sizes(),a._init_matrix_tooltip();var c=a._min_date;z.call(this,a._els.dhx_cal_header[0]),b.call(this,a._els.dhx_cal_data[0]),a._min_date=c,a._els.dhx_cal_date[0].innerHTML=a.templates[this.name+"_date"](a._min_date,a._max_date),a._mark_now&&a._mark_now()}m()}function m(){a._tooltip&&(a._tooltip.style.display="none",a._tooltip.date="")}function A(I,v,h){if("cell"==I.render){var l=v.x+"_"+v.y,f=I._matrix[v.y][v.x];if(!f){return m()}if(f.sort(function(d,c){return d.start_date>c.start_date?1:-1}),a._tooltip){if(a._tooltip.date==l){return}a._tooltip.innerHTML=""}else{var J=a._tooltip=document.createElement("DIV");J.className="dhx_year_tooltip",document.body.appendChild(J),J.onclick=a._click.dhx_cal_data}for(var p="",H=0;H<f.length;H++){var g=f[H].color?"background-color:"+f[H].color+";":"",u=f[H].textColor?"color:"+f[H].textColor+";":"";p+="<div class='dhx_tooltip_line' event_id='"+f[H].id+"' style='"+g+u+"'>",p+="<div class='dhx_tooltip_date'>"+(f[H]._timed?a.templates.event_date(f[H].start_date):"")+"</div>",p+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",p+=a.templates[I.name+"_tooltip"](f[H].start_date,f[H].end_date,f[H])+"</div>"}a._tooltip.style.display="",a._tooltip.style.top="0px",a._tooltip.style.left=document.body.offsetWidth-h.left-a._tooltip.offsetWidth<0?h.left-a._tooltip.offsetWidth+"px":h.left+v.src.offsetWidth+"px",a._tooltip.date=l,a._tooltip.innerHTML=p,a._tooltip.style.top=document.body.offsetHeight-h.top-a._tooltip.offsetHeight<0?h.top-a._tooltip.offsetHeight+v.src.offsetHeight+"px":h.top+"px"}}function w(f){for(var d=f.parentNode.childNodes,c=0;c<d.length;c++){if(d[c]==f){return c}}return -1}function E(f){f=f||event;for(var d=f.target?f.target:f.srcElement;d&&"DIV"!=d.tagName;){d=d.parentNode}if(d&&"DIV"==d.tagName){var c=d.className.split(" ")[0];if("dhx_scale_bar"==c){return{x:w(d),y:-1,src:d,scale:!0}}}}a.matrix={},a._merge=function(f,d){for(var c in d){"undefined"==typeof f[c]&&(f[c]=d[c])}},a.createTimelineView=function(f){a._skin_init(),a._merge(f,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:a.xy.bar_height-5,event_min_dy:a.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(l,g,o){var h={};return a.checkEvent("onBeforeSectionRender")&&(h=a.callEvent("onBeforeSectionRender",[l,g,o])),h}}),f._original_x_start=f.x_start,"day"!=f.x_unit&&(f.first_hour=f.last_hour=0),f._start_correction=f.first_hour?60*f.first_hour*60*1000:0,f._end_correction=f.last_hour?60*(24-f.last_hour)*60*1000:0,a.checkEvent("onTimelineCreated")&&a.callEvent("onTimelineCreated",[f]);var c=a.render_data;a.render_data=function(l,g){if(this._mode!=f.name){return c.apply(this,arguments)}if(g&&!f.show_unassigned&&"cell"!=f.render){for(var h=0;h<l.length;h++){this.clear_event(l[h]),this.render_timeline_event.call(this.matrix[this._mode],l[h],!0)}}else{a._renderMatrix.call(f,!0,!0)}},a.matrix[f.name]=f,a.templates[f.name+"_cell_value"]=function(g){return g?g.length:""},a.templates[f.name+"_cell_class"]=function(){return""},a.templates[f.name+"_scalex_class"]=function(){return""},a.templates[f.name+"_second_scalex_class"]=function(){return""},a.templates[f.name+"_scaley_class"]=function(){return""},a.templates[f.name+"_scale_label"]=function(h,g){return g},a.templates[f.name+"_tooltip"]=function(i,h,g){return g.text},a.templates[f.name+"_date"]=function(h,g){return h.getDay()==g.getDay()&&86400000>g-h||+h==+a.date.date_part(new Date(g))||+a.date.add(h,1,"day")==+g&&0===g.getHours()&&0===g.getMinutes()?a.templates.day_date(h):h.getDay()!=g.getDay()&&86400000>g-h?a.templates.day_date(h)+" &ndash; "+a.templates.day_date(g):a.templates.week_date(h,g)},a.templates[f.name+"_scale_date"]=a.date.date_to_str(f.x_date||a.config.hour_date),a.templates[f.name+"_second_scale_date"]=a.date.date_to_str(f.second_scale&&f.second_scale.x_date?f.second_scale.x_date:a.config.hour_date),a.date["add_"+f.name+"_private"]=function(g,p){var h=p,o=f.x_unit;if("minute"==f.x_unit||"hour"==f.x_unit){var l=h;"hour"==f.x_unit&&(l*=60),l%1440||(h=l/1440,o="day")}return a.date.add(g,h,o)},a.date["add_"+f.name]=function(g,u){var l=a.date["add_"+f.name+"_private"](g,(f.x_length||f.x_size)*f.x_step*u);if("minute"==f.x_unit||"hour"==f.x_unit){var p=f.x_length||f.x_size,o="hour"==f.x_unit?60*f.x_step:f.x_step;if(o*p%1440){if(+a.date.date_part(new Date(g))==+a.date.date_part(new Date(l))){f.x_start+=u*p}else{var t=1440/(p*o)-1,h=Math.round(t*p);f.x_start=u>0?f.x_start-h:h+f.x_start}}}return l},a.date[f.name+"_start"]=function(g){var l=a.date[f.x_unit+"_start"]||a.date.day_start,h=l.call(a.date,g);return h=a.date.add(h,f.x_step*f.x_start,f.x_unit)},a.callEvent("onOptionsLoad",[f]),a[f.name+"_view"]=function(g){g?a._set_timeline_dates(f):a._renderMatrix.apply(f,arguments)};var d=new Date;a.date.add(d,f.x_step,f.x_unit).valueOf()-d.valueOf();a["mouse_"+f.name]=function(g){var h=this._drag_event;this._drag_id&&(h=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),g.x-=f.dx;var n=a._timeline_drag_date(f,g.x);if(g.x=0,g.force_redraw=!0,g.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){var h=this.getEvent(this._drag_id),l=this._drag_event;if(g._ignores=this._ignores_detected||f._start_correction||f._end_correction,void 0===l._move_delta&&(l._move_delta=(h.start_date-n)/60000,this.config.preserve_length&&g._ignores&&(l._move_delta=this._get_real_event_length(h.start_date,n,f),l._event_length=this._get_real_event_length(h.start_date,h.end_date,f))),this.config.preserve_length&&g._ignores){var o=(l._event_length,this._get_fictional_event_length(n,l._move_delta,f,!0));n=new Date(n-o)}else{n=a.date.add(n,l._move_delta,"minute")}}if("resize"==this._drag_mode&&h&&(this._drag_from_start&&+n>+h.end_date?this._drag_from_start=!1:!this._drag_from_start&&+n<+h.start_date&&(this._drag_from_start=!0),g.resize_from_start=this._drag_from_start),f.round_position){switch(this._drag_mode){case"move":this.config.preserve_length||(n=k.call(f,n,!1),"day"==f.x_unit&&(g.custom=!1));break;case"resize":this._drag_event&&((null===this._drag_event._resize_from_start||void 0===this._drag_event._resize_from_start)&&(this._drag_event._resize_from_start=g.resize_from_start),g.resize_from_start=this._drag_event._resize_from_start,n=k.call(f,n,!this._drag_event._resize_from_start))}}return this._resolve_timeline_section(f,g),g.section&&this._update_timeline_section({pos:g,event:this.getEvent(this._drag_id),view:f}),g.y=Math.round((this._correct_shift(n,1)-this._min_date)/(60000*this.config.time_step)),g.shift=this.config.time_step,g}},a._get_timeline_event_height=function(f,d){var c=f[d.y_property],g=d.event_dy;return"full"==d.event_dy&&(g=d.section_autoheight?d._section_height[c]-6:d.dy-3),d.resize_events&&(g=Math.max(Math.floor(g/f._count),d.event_min_dy)),g},a._get_timeline_event_y=function(f,c){var g=f,d=2+g*c+(g?2*g:0);return a.config.cascade_event_display&&(d=2+g*a.config.cascade_event_margin+(g?2*g:0)),d},a.render_timeline_event=function(M,R){var U=M[this.y_property];if(!U){return""}var O=M._sorder,N=B(M,!1,this),Y=B(M,!0,this),ab=a._get_timeline_event_height(M,this),Q=ab-2;M._inner||"full"!=this.event_dy||(Q=(Q+2)*(M._count-O)-2);var T=a._get_timeline_event_y(M._sorder,ab),Z=ab+T+2;(!this._events_height[U]||this._events_height[U]<Z)&&(this._events_height[U]=Z);var V=a.templates.event_class(M.start_date,M.end_date,M);V="dhx_cal_event_line "+(V||""),M._no_drag_move&&(V+=" no_drag_move");var L=M.color?"background:"+M.color+";":"",K=M.textColor?"color:"+M.textColor+";":"",X=a.templates.event_bar_text(M.start_date,M.end_date,M),W='<div event_id="'+M.id+'" class="'+V+'" style="'+L+K+"position:absolute; top:"+T+"px; height: "+Q+"px; left:"+N+"px; width:"+Math.max(0,Y-N)+"px;"+(M._text_style||"")+'">';if(a.config.drag_resize&&!a.config.readonly){var P="dhx_event_resize",S="<div class='"+P+" "+P+"_start' style='height: "+Q+"px;'></div>",H="<div class='"+P+" "+P+"_end' style='height: "+Q+"px;'></div>";W+=(M._no_resize_start?"":S)+(M._no_resize_end?"":H)}if(W+=X+"</div>",!R){return W}var I=document.createElement("DIV");I.innerHTML=W;var aa=this.order[U],J=a._els.dhx_cal_data[0].firstChild.rows[aa].cells[1].firstChild;a._rendered.push(I.firstChild),J.appendChild(I.firstChild)},a._matrix_tooltip_handler=function(d){var c=a.matrix[a._mode];if(c&&"cell"==c.render){if(c){var f=a._locate_cell_timeline(d),d=d||event;d.target||d.srcElement;if(f){return A(c,f,getOffset(f.src))}}m()}},a._init_matrix_tooltip=function(){a._detachDomEvent(a._els.dhx_cal_data[0],"mouseover",a._matrix_tooltip_handler),dhtmlxEvent(a._els.dhx_cal_data[0],"mouseover",a._matrix_tooltip_handler)},a._set_timeline_dates=function(c){a._min_date=a.date[c.name+"_start"](a._date),a._max_date=a.date["add_"+c.name+"_private"](a._min_date,c.x_size*c.x_step),a._table_view=!0},a._renderMatrix=function(d,c){if(c||(a._els.dhx_cal_data[0].scrollTop=0),a._set_timeline_dates(this),this.second_scale&&(d&&!this._header_resized&&(this._header_resized=a.xy.scale_height,a.xy.scale_height*=2,a._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!d&&this._header_resized)){a.xy.scale_height/=2,this._header_resized=!1;var f=a._els.dhx_cal_header[0];f.className=f.className.replace(/ dhx_second_cal_header/gi,"")}j.call(this,d)},a._locate_cell_timeline=function(h){h=h||event;for(var c=h.target?h.target:h.srcElement,u={},g=a.matrix[a._mode],o=a.getActionData(h),l=0;l<g._trace_x.length-1&&!(+o.date<g._trace_x[l+1]);l++){}u.x=l,u.y=g.order[o.section];var p=a._isRender("cell")?1:0;u.src=g._scales[o.section]?g._scales[o.section].getElementsByTagName("td")[l+p]:null;for(var f=!1;0===u.x&&"dhx_cal_data"!=c.className&&c.parentNode;){if("dhx_matrix_scell"==c.className.split(" ")[0]){f=!0;break}c=c.parentNode}return f&&(u.x=-1,u.src=c,u.scale=!0),u};var C=a._click.dhx_cal_data;a._click.dhx_marked_timespan=a._click.dhx_cal_data=function(f){var c=C.apply(this,arguments),g=a.matrix[a._mode];if(g){var d=a._locate_cell_timeline(f);d&&(d.scale?a.callEvent("onYScaleClick",[d.y,g.y_unit[d.y],f||event]):a.callEvent("onCellClick",[d.x,d.y,g._trace_x[d.x],(g._matrix[d.y]||{})[d.x]||[],f||event]))}return c},a.dblclick_dhx_matrix_cell=function(d){var c=a.matrix[a._mode];if(c){var f=a._locate_cell_timeline(d);f&&(f.scale?a.callEvent("onYScaleDblClick",[f.y,c.y_unit[f.y],d||event]):a.callEvent("onCellDblClick",[f.x,f.y,c._trace_x[f.x],(c._matrix[f.y]||{})[f.x]||[],d||event]))}};var y=a.dblclick_dhx_marked_timespan||function(){};a.dblclick_dhx_marked_timespan=function(d){var c=a.matrix[a._mode];return c?a.dblclick_dhx_matrix_cell(d):y.apply(this,arguments)},a.dblclick_dhx_matrix_scell=function(c){return a.dblclick_dhx_matrix_cell(c)},a._isRender=function(c){return a.matrix[a._mode]&&a.matrix[a._mode].render==c},a.attachEvent("onCellDblClick",function(g,c,p,f,l){if(!this.config.readonly&&("dblclick"!=l.type||this.config.dblclick_create)){var h=a.matrix[a._mode],o={};o.start_date=h._trace_x[g],o.end_date=h._trace_x[g+1]?h._trace_x[g+1]:a.date.add(h._trace_x[g],h.x_step,h.x_unit),h._start_correction&&(o.start_date=new Date(1*o.start_date+h._start_correction)),h._end_correction&&(o.end_date=new Date(o.end_date-h._end_correction)),o[h.y_property]=h.y_unit[c].key,a.addEventNow(o,null,l)}}),a.attachEvent("onBeforeDrag",function(){return !a._isRender("cell")}),a.attachEvent("onEventChanged",function(d,c){c._timed=this.isOneDayEvent(c)}),a.attachEvent("onBeforeEventChanged",function(c){return a._events[c.id]&&(c._move_delta=void 0),!0}),a._is_column_visible=function(d){var c=a.matrix[a._mode],f=a._get_date_index(c,d);return !a._ignores[f]};var x=a._render_marked_timespan;a._render_marked_timespan=function(W,ad,ah,aa,Y){if(!a.config.display_marked_timespans){return[]}if(a.matrix&&a.matrix[a._mode]){if(a._isRender("cell")){return}var ak=a._lame_copy({},a.matrix[a._mode]);ak.round_position=!1;var an=[],ac=[],af=[],al=W.sections?W.sections.units||W.sections.timeline:null;if(ah){af=[ad],ac=[ah]}else{var ai=ak.order;if(al){ai.hasOwnProperty(al)&&(ac.push(al),af.push(ak._scales[al]))}else{for(var U in ai){ai.hasOwnProperty(U)&&(ac.push(U),af.push(ak._scales[U]))}}}var aa=aa?new Date(aa):a._min_date,Y=Y?new Date(Y):a._max_date;aa.valueOf()<a._min_date.valueOf()&&(aa=new Date(a._min_date)),Y.valueOf()>a._max_date.valueOf()&&(Y=new Date(a._max_date));for(var S=0;S<ak._trace_x.length&&!a._is_column_visible(ak._trace_x[S]);S++){}if(S==ak._trace_x.length){return}var aj=[];if(W.days>6){var ab=new Date(W.days);a.date.date_part(new Date(aa))<=+ab&&+Y>=+ab&&aj.push(ab)}else{aj.push.apply(aj,a._get_dates_by_index(W.days))}for(var ae=W.zones,P=a._get_css_classes_by_config(W),Q=0;Q<ac.length;Q++){ad=af[Q],ah=ac[Q];for(var S=0;S<aj.length;S++){for(var am=aj[S],R=0;R<ae.length;R+=2){var ag=ae[R],V=ae[R+1],X=new Date(+am+60*ag*1000),I=new Date(+am+60*V*1000);if(I>aa&&Y>X){var J=a._get_block_by_config(W);J.className=P;var Z=B({start_date:X},!1,ak)-1,H=B({start_date:I},!1,ak)-1,K=Math.max(1,H-Z-1),g=ak._section_height[ah]-1;J.style.cssText="height: "+g+"px; left: "+Z+"px; width: "+K+"px; top: 0;",ad.insertBefore(J,ad.firstChild),an.push(J)}}}}return an}return x.apply(a,[W,ad,ah])};var e=a._append_mark_now;a._append_mark_now=function(f,c){if(a.matrix&&a.matrix[a._mode]){var h=a._currentDate(),d=a._get_zone_minutes(h),g={days:+a.date.date_part(h),zones:[d,d+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return a._render_marked_timespan(g)}return e.apply(a,[f,c])},a.attachEvent("onScaleAdd",function(W,S){var K=a._marked_timespans;if(K&&a.matrix&&a.matrix[a._mode]){for(var M=a._mode,H=a._min_date,X=a._max_date,Q=K.global,U=a.date.date_part(new Date(H));X>U;U=a.date.add(U,1,"day")){var J=+U,L=U.getDay(),R=[],N=Q[J]||Q[L];if(R.push.apply(R,a._get_configs_to_render(N)),K[M]&&K[M][S]){var V=[],T=a._get_types_to_render(K[M][S][L],K[M][S][J]);V.push.apply(V,a._get_configs_to_render(T)),V.length&&(R=V)}for(var P=0;P<R.length;P++){var O=R[P],I=O.days;7>I?(I=J,a._render_marked_timespan(O,W,S,U,a.date.add(U,1,"day")),I=L):a._render_marked_timespan(O,W,S,U,a.date.add(U,1,"day"))}}}}),a._resolve_timeline_section=function(f,d){var c=0,g=0;for(c;c<this._colsS.heights.length&&(g+=this._colsS.heights[c],!(g>d.y));c++){}f.y_unit[c]||(c=f.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=f.y_unit[c].key),d.fields={},c>=0&&f.y_unit[c]&&(d.section=d.fields[f.y_property]=f.y_unit[c].key)},a._update_timeline_section=function(g){var f=g.view,c=g.event,h=g.pos;if(c){if(c[f.y_property]!=h.section){var d=this._get_timeline_event_height(c,f);c._sorder=this._get_dnd_order(c._sorder,d,f._section_height[h.section])}c[f.y_property]=h.section}},a._get_date_index=function(f,d){for(var c=0,g=f._trace_x;c<g.length-1&&+d>=+g[c+1];){c++}return c},a._timeline_drag_date=function(K,I){var h,u,f=K,L={x:I},v=0,J=0;for(J;J<=this._cols.length-1;J++){if(u=this._cols[J],v+=u,v>L.x){h=(L.x-(v-u))/u,h=0>h?0:h;break}}if(f.round_position){var g=1;a.getState().drag_mode&&"move"!=a.getState().drag_mode&&(g=0.5),h>=g&&J++,h=0}if(0===J&&this._ignores[0]){for(J=1,h=0;this._ignores[J];){J++}}else{if(J==this._cols.length&&this._ignores[J-1]){for(J=this._cols.length-1,h=0;this._ignores[J];){J--}J++}}var p;if(J>=f._trace_x.length){p=a.date.add(f._trace_x[f._trace_x.length-1],f.x_step,f.x_unit),f._end_correction&&(p=new Date(p-f._end_correction))}else{var H=h*u*f._step+f._start_correction;p=new Date(+f._trace_x[J]+H)}return p},a.attachEvent("onBeforeTodayDisplayed",function(){for(var d in a.matrix){var c=a.matrix[d];c.x_start=c._original_x_start}return !0}),a.attachEvent("onOptionsLoad",function(){for(var d in a.matrix){var c=a.matrix[d];c.order={},a.callEvent("onOptionsLoadStart",[]);for(var d=0;d<c.y_unit.length;d++){c.order[c.y_unit[d].key]=d}a.callEvent("onOptionsLoadFinal",[]),a._date&&c.name==a._mode&&a.setCurrentView(a._date,a._mode)}}),a.attachEvent("onSchedulerResize",function(){if(a.matrix[this._mode]){var c=a.matrix[this._mode];return a._renderMatrix.call(c,!0,!0),!1}return !0}),a.attachEvent("onBeforeDrag",function(f,c,g){if("resize"==c){var d=g.target||g.srcElement;a._drag_from_start=(d.className||"").indexOf("dhx_event_resize_end")<0?!0:!1}return !0})},a._temp_matrix_scope()});
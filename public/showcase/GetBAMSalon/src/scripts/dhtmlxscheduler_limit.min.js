Scheduler.plugin(function(a){a.config.limit_start=null,a.config.limit_end=null,a.config.limit_view=!1,a.config.check_limits=!0,a.config.mark_now=!0,a.config.display_marked_timespans=!0,a._temp_limit_scope=function(){function e(C,z,v,p,k){var D=a,x=[],m={_props:"map_to",matrix:"y_property"};for(var q in m){var A=m[q];if(D[q]){for(var w in D[q]){var y=D[q][w],B=y[A];C[B]&&(x=D._add_timespan_zones(x,a._get_blocked_zones(z[w],C[B],v,p,k)))}}}return x=D._add_timespan_zones(x,a._get_blocked_zones(z,"global",v,p,k))}var b=null,c="dhx_time_block",j="default",g=function(k,i,d){return i instanceof Date&&d instanceof Date?(k.start_date=i,k.end_date=d):(k.days=i,k.zones=d),k},f=function(k,i,d){var l="object"==typeof k?k:{days:k};return l.type=c,l.css="",i&&(d&&(l.sections=d),l=g(l,k,i)),l};a.blockTime=function(l,d,k){var m=f(l,d,k);return a.addMarkedTimespan(m)},a.unblockTime=function(l,d,k){d=d||"fullday";var m=f(l,d,k);return a.deleteMarkedTimespan(m)},a.attachEvent("onBeforeViewChange",function(l,d,k,o){function m(s,p){var q=a.config.limit_start,v=a.config.limit_end,u=a.date.add(s,1,p);return s.valueOf()>v.valueOf()||u<=q.valueOf()}return a.config.limit_view&&(o=o||d,k=k||l,m(o,k)&&d.valueOf()!=o.valueOf())?(setTimeout(function(){var i=m(d,k)?a.config.limit_start:d;a.setCurrentView(m(i,k)?null:i,k)},1),!1):!0}),a.checkInMarkedTimespan=function(B,t,k){t=t||j;for(var F=!0,z=new Date(B.start_date.valueOf()),n=a.date.add(z,1,"day"),q=a._marked_timespans;z<B.end_date;z=a.date.date_part(n),n=a.date.add(z,1,"day")){var D=+a.date.date_part(new Date(z)),w=z.getDay(),A=e(B,q,w,D,t);if(A){for(var E=0;E<A.length;E+=2){var C=a._get_zone_minutes(z),y=B.end_date>n||B.end_date.getDate()!=z.getDate()?1440:a._get_zone_minutes(B.end_date),x=A[E],p=A[E+1];if(y>x&&p>C&&(F="function"==typeof k?k(B,C,y,x,p):!1,!F)){break}}}}return !F};var h=a.checkLimitViolation=function(x){if(!x){return !0}if(!a.config.check_limits){return !0}var v=a,m=v.config,i=[];if(x.rec_type){for(var y=a.getRecDates(x),u=0;u<y.length;u++){var k=a._copy_event(x);a._lame_copy(k,y[u]),i.push(k)}}else{i=[x]}for(var p=!0,w=0;w<i.length;w++){var q=!0,k=i[w];k._timed=a.isOneDayEvent(k),q=m.limit_start&&m.limit_end?k.start_date.valueOf()>=m.limit_start.valueOf()&&k.end_date.valueOf()<=m.limit_end.valueOf():!0,q&&(q=!a.checkInMarkedTimespan(k,c,function(A,l,d,B,z){var o=!0;return z>=l&&l>=B&&((1440==z||z>d)&&(o=!1),A._timed&&v._drag_id&&"new-size"==v._drag_mode?(A.start_date.setHours(0),A.start_date.setMinutes(z)):o=!1),(d>=B&&z>d||B>l&&d>z)&&(A._timed&&v._drag_id&&"new-size"==v._drag_mode?(A.end_date.setHours(0),A.end_date.setMinutes(B)):o=!1),o})),q||(q=v.checkEvent("onLimitViolation")?v.callEvent("onLimitViolation",[k.id,k]):q),p=p&&q}return p||(v._drag_id=null,v._drag_mode=null),p};a._get_blocked_zones=function(q,w,v,p,m){var k=[];if(q&&q[w]){for(var x=q[w],u=this._get_relevant_blocked_zones(v,p,x,m),l=0;l<u.length;l++){k=this._add_timespan_zones(k,u[l].zones)}}return k},a._get_relevant_blocked_zones=function(m,l,d,k){var o=d[l]&&d[l][k]?d[l][k]:d[m]&&d[m][k]?d[m][k]:[];return o},a.attachEvent("onMouseDown",function(d){return !(d==c)}),a.attachEvent("onBeforeDrag",function(d){return d?h(a.getEvent(d)):!0}),a.attachEvent("onClick",function(d){return h(a.getEvent(d))}),a.attachEvent("onBeforeLightbox",function(k){var d=a.getEvent(k);return b=[d.start_date,d.end_date],h(d)}),a.attachEvent("onEventSave",function(l,d){if(!d.start_date||!d.end_date){var k=a.getEvent(l);d.start_date=new Date(k.start_date),d.end_date=new Date(k.end_date)}if(d.rec_type){var m=a._lame_clone(d);return a._roll_back_dates(m),h(m)}return h(d)}),a.attachEvent("onEventAdded",function(i){if(!i){return !0}var d=a.getEvent(i);return !h(d)&&a.config.limit_start&&a.config.limit_end&&(d.start_date<a.config.limit_start&&(d.start_date=new Date(a.config.limit_start)),d.start_date.valueOf()>=a.config.limit_end.valueOf()&&(d.start_date=this.date.add(a.config.limit_end,-1,"day")),d.end_date<a.config.limit_start&&(d.end_date=new Date(a.config.limit_start)),d.end_date.valueOf()>=a.config.limit_end.valueOf()&&(d.end_date=this.date.add(a.config.limit_end,-1,"day")),d.start_date.valueOf()>=d.end_date.valueOf()&&(d.end_date=this.date.add(d.start_date,this.config.event_duration||this.config.time_step,"minute")),d._timed=this.isOneDayEvent(d)),!0}),a.attachEvent("onEventChanged",function(k){if(!k){return !0}var d=a.getEvent(k);if(!h(d)){if(!b){return !1}d.start_date=b[0],d.end_date=b[1],d._timed=this.isOneDayEvent(d)}return !0}),a.attachEvent("onBeforeEventChanged",function(d){return h(d)}),a.attachEvent("onBeforeEventCreated",function(l){var d=a.getActionData(l).date,k={_timed:!0,start_date:d,end_date:a.date.add(d,a.config.time_step,"minute")};return h(k)}),a.attachEvent("onViewChange",function(){a._mark_now()}),a.attachEvent("onSchedulerResize",function(){return window.setTimeout(function(){a._mark_now()},1),!0}),a.attachEvent("onTemplatesReady",function(){a._mark_now_timer=window.setInterval(function(){a._is_initialized()&&a._mark_now()},60000)}),a._mark_now=function(l){var d="dhx_now_time";this._els[d]||(this._els[d]=[]);var k=a._currentDate(),o=this.config;if(a._remove_mark_now(),!l&&o.mark_now&&k<this._max_date&&k>this._min_date&&k.getHours()>=o.first_hour&&k.getHours()<o.last_hour){var m=this.locate_holder_day(k);this._els[d]=a._append_mark_now(m,k)}},a._append_mark_now=function(C,z){var v="dhx_now_time",p=a._get_zone_minutes(z),k={zones:[p,p+1],css:v,type:v};if(!this._table_view){if(this._props&&this._props[this._mode]){for(var D=this._props[this._mode],x=D.options.length,m=C*x,q=(C+1)*x,A=(this._els.dhx_cal_data[0].childNodes,[]),w=m;q>w;w++){var y=w;k.days=y;var B=a._render_marked_timespan(k,null,y)[0];A.push(B)}return A}return k.days=C,a._render_marked_timespan(k,null,C)}return"month"==this._mode?(k.days=+a.date.date_part(z),a._render_marked_timespan(k,null,null)):void 0},a._remove_mark_now=function(){for(var m="dhx_now_time",l=this._els[m],d=0;d<l.length;d++){var k=l[d],o=k.parentNode;o&&o.removeChild(k)}this._els[m]=[]},a._marked_timespans={global:{}},a._get_zone_minutes=function(d){return 60*d.getHours()+d.getMinutes()},a._prepare_timespan_options=function(z){var N=[],G=[];if("fullweek"==z.days&&(z.days=[0,1,2,3,4,5,6]),z.days instanceof Array){for(var B=z.days.slice(),A=0;A<B.length;A++){var K=a._lame_clone(z);K.days=B[A],N.push.apply(N,a._prepare_timespan_options(K))}return N}if(!z||!(z.start_date&&z.end_date&&z.end_date>z.start_date||void 0!==z.days&&z.zones)){return N}var D=0,F=1440;"fullday"==z.zones&&(z.zones=[D,F]),z.zones&&z.invert_zones&&(z.zones=a.invertZones(z.zones)),z.id=a.uid(),z.css=z.css||"",z.type=z.type||j;var O=z.sections;if(O){for(var H in O){if(O.hasOwnProperty(H)){var L=O[H];L instanceof Array||(L=[L]);for(var A=0;A<L.length;A++){var w=a._lame_copy({},z);w.sections={},w.sections[H]=L[A],G.push(w)}}}}else{G.push(z)}for(var q=0;q<G.length;q++){var J=G[q],I=J.start_date,E=J.end_date;if(I&&E){for(var C=a.date.date_part(new Date(I)),n=a.date.add(C,1,"day");E>C;){var w=a._lame_copy({},J);delete w.start_date,delete w.end_date,w.days=C.valueOf();var k=I>C?a._get_zone_minutes(I):D,M=E>n||E.getDate()!=C.getDate()?F:a._get_zone_minutes(E);w.zones=[k,M],N.push(w),C=n,n=a.date.add(n,1,"day")}}else{J.days instanceof Date&&(J.days=a.date.date_part(J.days).valueOf()),J.zones=z.zones.slice(),N.push(J)}}return N},a._get_dates_by_index=function(m,k,l){var u=[];k=a.date.date_part(new Date(k||a._min_date)),l=new Date(l||a._max_date);for(var p=k.getDay(),o=m-p>=0?m-p:7-k.getDay()+m,q=a.date.add(k,o,"day");l>q;q=a.date.add(q,1,"week")){u.push(q)}return u},a._get_css_classes_by_config=function(i){var d=[];return i.type==c&&(d.push(c),i.css&&d.push(c+"_reset")),d.push("dhx_marked_timespan",i.css),d.join(" ")},a._get_block_by_config=function(i){var d=document.createElement("DIV");return i.html&&("string"==typeof i.html?d.innerHTML=i.html:d.appendChild(i.html)),d},a._render_marked_timespan=function(R,al,ae){var aa=[],X=a.config,V=this._min_date,ai=this._max_date,Z=!1;if(!X.display_marked_timespans){return aa}if(!ae&&0!==ae){if(R.days<7){ae=R.days}else{var ac=new Date(R.days);if(Z=+ac,!(+ai>+ac&&+ac>=+V)){return aa}ae=ac.getDay()}var am=V.getDay();am>ae?ae=7-(am-ae):ae-=am}var af=R.zones,aj=a._get_css_classes_by_config(R);if(a._table_view&&"month"==a._mode){var P=[],K=[];if(al){P.push(al),K.push(ae)}else{K=Z?[Z]:a._get_dates_by_index(ae);for(var ah=0;ah<K.length;ah++){P.push(this._scales[K[ah]])}}for(var ah=0;ah<P.length;ah++){al=P[ah],ae=K[ah];var ag=Math.floor((this._correct_shift(ae,1)-V.valueOf())/(86400000*this._cols.length)),ab=this.locate_holder_day(ae,!1)%this._cols.length;if(!this._ignores[ab]){var Y=a._get_block_by_config(R),I=Math.max(al.offsetHeight-1,0),H=Math.max(al.offsetWidth-1,0),ak=this._colsS[ab],J=this._colsS.heights[ag]+(this._colsS.height?this.xy.month_scale_height+2:2)-1;Y.className=aj,Y.style.top=J+"px",Y.style.lineHeight=Y.style.height=I+"px";for(var Q=0;Q<af.length;Q+=2){var U=af[ah],ad=af[ah+1];if(U>=ad){return[]}var F=Y.cloneNode(!0);F.style.left=ak+Math.round(U/1440*H)+"px",F.style.width=Math.round((ad-U)/1440*H)+"px",al.appendChild(F),aa.push(F)}}}}else{var B=ae;if(this._ignores[this.locate_holder_day(ae,!1)]){return aa}if(this._props&&this._props[this._mode]&&R.sections&&R.sections[this._mode]){var A=this._props[this._mode];B=A.order[R.sections[this._mode]];var G=A.order[R.sections[this._mode]];if(A.days>1){var z=A.options.length;B=B*z+G}else{B=G,A.size&&B>A.position+A.size&&(B=0)}}al=al?al:a.locate_holder(B);for(var ah=0;ah<af.length;ah+=2){var U=Math.max(af[ah],60*X.first_hour),ad=Math.min(af[ah+1],60*X.last_hour);if(U>=ad){if(ah+2<af.length){continue}return[]}var F=a._get_block_by_config(R);F.className=aj;var W=24*this.config.hour_size_px+1,q=3600000;F.style.top=Math.round((60*U*1000-this.config.first_hour*q)*this.config.hour_size_px/q)%W+"px",F.style.lineHeight=F.style.height=Math.max(Math.round(60*(ad-U)*1000*this.config.hour_size_px/q)%W,1)+"px",al.appendChild(F),aa.push(F)}}return aa},a.markTimespan=function(l){var d=a._prepare_timespan_options(l);if(d.length){for(var k=[],p=0;p<d.length;p++){var o=d[p],m=a._render_marked_timespan(o,null,null);m.length&&k.push.apply(k,m)}return k}},a.unmarkTimespan=function(k){if(k){for(var i=0;i<k.length;i++){var d=k[i];d.parentNode&&d.parentNode.removeChild(d)}}},a._marked_timespans_ids={},a.addMarkedTimespan=function(F){var B=a._prepare_timespan_options(F),w="global";if(B.length){var p=B[0].id,k=a._marked_timespans,G=a._marked_timespans_ids;G[p]||(G[p]=[]);for(var z=0;z<B.length;z++){var m=B[z],q=m.days,D=(m.zones,m.css,m.sections),x=m.type;if(m.id=p,D){for(var A in D){if(D.hasOwnProperty(A)){k[A]||(k[A]={});var E=D[A],C=k[A];C[E]||(C[E]={}),C[E][q]||(C[E][q]={}),C[E][q][x]||(C[E][q][x]=[],a._marked_timespans_types||(a._marked_timespans_types={}),a._marked_timespans_types[x]||(a._marked_timespans_types[x]=!0));var y=C[E][q][x];m._array=y,y.push(m),G[p].push(m)}}}else{k[w][q]||(k[w][q]={}),k[w][q][x]||(k[w][q][x]=[]),a._marked_timespans_types||(a._marked_timespans_types={}),a._marked_timespans_types[x]||(a._marked_timespans_types[x]=!0);var y=k[w][q][x];m._array=y,y.push(m),G[p].push(m)}}return p}},a._add_timespan_zones=function(v,z){var x=v.slice();if(z=z.slice(),!x.length){return z}for(var u=0;u<x.length;u+=2){for(var p=x[u],k=x[u+1],A=u+2==x.length,w=0;w<z.length;w+=2){var m=z[w],q=z[w+1];if(q>k&&k>=m||p>m&&q>=p){x[u]=Math.min(p,m),x[u+1]=Math.max(k,q),u-=2}else{if(!A){continue}var y=p>m?0:2;x.splice(u+y,0,m,q)}z.splice(w--,2);break}}return x},a._subtract_timespan_zones=function(v,y){for(var x=v.slice(),u=0;u<x.length;u+=2){for(var p=x[u],k=x[u+1],z=0;z<y.length;z+=2){var w=y[z],m=y[z+1];if(m>p&&k>w){var q=!1;p>=w&&m>=k&&x.splice(u,2),w>p&&(x.splice(u,2,p,w),q=!0),k>m&&x.splice(q?u+2:u,q?0:2,m,k),u-=2;break}}}return x},a.invertZones=function(d){return a._subtract_timespan_zones([0,1440],d.slice())},a._delete_marked_timespan_by_id=function(l){var d=a._marked_timespans_ids[l];if(d){for(var k=0;k<d.length;k++){for(var p=d[k],o=p._array,m=0;m<o.length;m++){if(o[m]==p){o.splice(m,1);break}}}}},a._delete_marked_timespan_by_config=function(D){var z=a._marked_timespans,p=D.sections,k=D.days,E=D.type||j,x=[];if(p){for(var m in p){if(p.hasOwnProperty(m)&&z[m]){var n=p[m];z[m][n]&&z[m][n][k]&&z[m][n][k][E]&&(x=z[m][n][k][E])}}}else{z.global[k]&&z.global[k][E]&&(x=z.global[k][E])}for(var B=0;B<x.length;B++){var q=x[B],y=a._subtract_timespan_zones(q.zones,D.zones);if(y.length){q.zones=y}else{x.splice(B,1),B--;for(var C=a._marked_timespans_ids[q.id],A=0;A<C.length;A++){if(C[A]==q){C.splice(A,1);break}}}}for(var B in a._marked_timespans.timeline){for(var w in a._marked_timespans.timeline[B]){for(var A in a._marked_timespans.timeline[B][w]){A===E&&delete a._marked_timespans.timeline[B][w][A]}}}},a.deleteMarkedTimespan=function(m){if(arguments.length||(a._marked_timespans={global:{}},a._marked_timespans_ids={},a._marked_timespans_types={}),"object"!=typeof m){a._delete_marked_timespan_by_id(m)}else{m.start_date&&m.end_date||(m.days||(m.days="fullweek"),m.zones||(m.zones="fullday"));var k=[];if(m.type){k.push(m.type)}else{for(var l in a._marked_timespans_types){k.push(l)}}for(var w=a._prepare_timespan_options(m),q=0;q<w.length;q++){for(var p=w[q],v=0;v<k.length;v++){var u=a._lame_clone(p);u.type=k[v],a._delete_marked_timespan_by_config(u)}}}},a._get_types_to_render=function(m,l){var d=m?m:{};for(var k in l||{}){l.hasOwnProperty(k)&&(d[k]=l[k])}return d},a._get_configs_to_render=function(k){var i=[];for(var d in k){k.hasOwnProperty(d)&&i.push.apply(i,k[d])}return i},a.attachEvent("onScaleAdd",function(w,K){if(!a._table_view||"month"==a._mode){var E=K.getDay(),B=K.valueOf(),y=this._mode,x=a._marked_timespans,I=[];if(this._props&&this._props[y]){var A=this._props[y],D=A.options,L=a._get_unit_index(A,K),F=D[L];if(A.days>1){var J=86400000,q=Math.floor((K-a._min_date)/J);K=a.date.add(a._min_date,Math.floor(q/D.length),"day"),K=a.date.date_part(K)}else{K=a.date.date_part(new Date(this._date))}if(E=K.getDay(),B=K.valueOf(),x[y]&&x[y][F.key]){var k=x[y][F.key],H=a._get_types_to_render(k[E],k[B]);I.push.apply(I,a._get_configs_to_render(H))}}var G=x.global,C=G[B]||G[E];I.push.apply(I,a._get_configs_to_render(C));for(var z=0;z<I.length;z++){a._render_marked_timespan(I[z],w,K)}}}),a.dblclick_dhx_marked_timespan=function(i,d){a.config.dblclick_create||a.callEvent("onScaleDblClick",[a.getActionData(i).date,d,i]),a.addEventNow(a.getActionData(i).date,null,i)}},a._temp_limit_scope()});
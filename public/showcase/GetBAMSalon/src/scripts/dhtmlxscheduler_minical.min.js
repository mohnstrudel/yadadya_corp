Scheduler.plugin(function(a){a.templates.calendar_month=a.date.date_to_str("%F %Y"),a.templates.calendar_scale_date=a.date.date_to_str("%D"),a.templates.calendar_date=a.date.date_to_str("%d"),a.config.minicalendar={mark_events:!0},a._synced_minicalendars=[],a.renderCalendar=function(B,x,g){var k=null,b=B.date||a._currentDate();if("string"==typeof b&&(b=this.templates.api_date(b)),x){k=this._render_calendar(x.parentNode,b,B,x),a.unmarkCalendar(k)}else{var C=B.container,q=B.position;if("string"==typeof C&&(C=document.getElementById(C)),"string"==typeof q&&(q=document.getElementById(q)),q&&"undefined"==typeof q.left){var e=getOffset(q);q={top:e.top+q.offsetHeight,left:e.left}}C||(C=a._get_def_cont(q)),k=this._render_calendar(C,b,B),k.onclick=function(f){f=f||event;var c=f.target||f.srcElement;if(-1!=c.className.indexOf("dhx_month_head")){var h=c.parentNode.className;if(-1==h.indexOf("dhx_after")&&-1==h.indexOf("dhx_before")){var d=a.templates.xml_date(this.getAttribute("date"));d.setDate(parseInt(c.innerHTML,10)),a.unmarkCalendar(this),a.markCalendar(this,d,"dhx_calendar_click"),this._last_date=d,this.conf.handler&&this.conf.handler.call(a,d,this)}}}}if(a.config.minicalendar.mark_events){for(var z=a.date.month_start(b),j=a.date.add(z,1,"month"),m=this.getEvents(z,j),w=this["filter_"+this._mode],A=0;A<m.length;A++){var y=m[A];if(!w||w(y.id,y)){var p=y.start_date;for(p.valueOf()<z.valueOf()&&(p=z),p=a.date.date_part(new Date(p.valueOf()));p<y.end_date&&(this.markCalendar(k,p,"dhx_year_event"),p=this.date.add(p,1,"day"),!(p.valueOf()>=j.valueOf()));){}}}}return this._markCalendarCurrentDate(k),k.conf=B,B.sync&&!g&&this._synced_minicalendars.push(k),k.conf._on_xle_handler||(k.conf._on_xle_handler=a.attachEvent("onXLE",function(){a.updateCalendar(k,k.conf.date)})),k},a._get_def_cont=function(b){return this._def_count||(this._def_count=document.createElement("DIV"),this._def_count.className="dhx_minical_popup",this._def_count.onclick=function(c){(c||event).cancelBubble=!0},document.body.appendChild(this._def_count)),this._def_count.style.left=b.left+"px",this._def_count.style.top=b.top+"px",this._def_count._created=new Date,this._def_count},a._locateCalendar=function(e,b){if("string"==typeof b&&(b=a.templates.api_date(b)),+b>+e._max_date||+b<+e._min_date){return null}for(var j=e.childNodes[2].childNodes[0],c=0,g=new Date(e._min_date);+this.date.add(g,1,"week")<=+b;){g=this.date.add(g,1,"week"),c++}var f=a.config.start_on_monday,h=(b.getDay()||(f?7:0))-(f?1:0);return j.rows[c].cells[h].firstChild},a.markCalendar=function(d,c,b){var f=this._locateCalendar(d,c);f&&(f.className+=" "+b)},a.unmarkCalendar=function(d,c,b){if(c=c||d._last_date,b=b||"dhx_calendar_click",c){var f=this._locateCalendar(d,c);f&&(f.className=(f.className||"").replace(RegExp(b,"g")))}},a._week_template=function(d){for(var b=d||250,g=0,c=document.createElement("div"),f=this.date.week_start(a._currentDate()),e=0;7>e;e++){this._cols[e]=Math.floor(b/(7-e)),this._render_x_header(e,g,f,c),f=this.date.add(f,1,"day"),b-=this._cols[e],g+=this._cols[e]}return c.lastChild.className+=" dhx_scale_bar_last",c},a.updateCalendar=function(c,b){c.conf.date=b,this.renderCalendar(c.conf,c,!0)},a._mini_cal_arrows=["&nbsp","&nbsp"],a._render_calendar=function(H,ab,Q,U){var K=a.templates,J=this._cols;this._cols=[];var Y=this._mode;this._mode="calendar";var P=this._colsS;this._colsS={height:0};var ac=new Date(this._min_date),S=new Date(this._max_date),V=new Date(a._date),Z=K.month_day,F=this._ignores_detected;this._ignores_detected=0,K.month_day=K.calendar_date,ab=this.date.month_start(ab);var C,X=this._week_template(H.offsetWidth-1-this.config.minicalendar.padding);if(U?C=U:(C=document.createElement("DIV"),C.className="dhx_cal_container dhx_mini_calendar"),C.setAttribute("date",this.templates.xml_format(ab)),C.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+X.innerHTML+"</div><div class='dhx_year_body'></div>",C.childNodes[0].innerHTML=this.templates.calendar_month(ab),Q.navigation){for(var W=function(c,b){var d=a.date.add(c._date,b,"month");a.updateCalendar(c,d),a._date.getMonth()==c._date.getMonth()&&a._date.getFullYear()==c._date.getFullYear()&&a._markCalendarCurrentDate(c)},R=["dhx_cal_prev_button","dhx_cal_next_button"],L=["left:1px;top:2px;position:absolute;","left:auto; right:1px;top:2px;position:absolute;"],A=[-1,1],z=function(b){return function(){if(Q.sync){for(var c=a._synced_minicalendars,d=0;d<c.length;d++){W(c[d],b)}}else{W(C,b)}}},aa=0;2>aa;aa++){var B=document.createElement("DIV");B.className=R[aa],B.style.cssText=L[aa],B.innerHTML=this._mini_cal_arrows[aa],C.firstChild.appendChild(B),B.onclick=z(A[aa])}}C._date=new Date(ab),C.week_start=(ab.getDay()-(this.config.start_on_monday?1:0)+7)%7;var G=C._min_date=this.date.week_start(ab);C._max_date=this.date.add(C._min_date,6,"week"),this._reset_month_scale(C.childNodes[2],ab,G);for(var I=C.childNodes[2].firstChild.rows,T=I.length;6>T;T++){var q=I[I.length-1];I[0].parentNode.appendChild(q.cloneNode(!0));var j=parseInt(q.childNodes[q.childNodes.length-1].childNodes[0].innerHTML);j=10>j?j:0;for(var e=0;e<I[T].childNodes.length;e++){I[T].childNodes[e].className="dhx_after",I[T].childNodes[e].childNodes[0].innerHTML=a.date.to_fixed(++j)}}return U||H.appendChild(C),C.childNodes[1].style.height=C.childNodes[1].childNodes[0].offsetHeight-1+"px",this._cols=J,this._mode=Y,this._colsS=P,this._min_date=ac,this._max_date=S,a._date=V,K.month_day=Z,this._ignores_detected=F,C},a.destroyCalendar=function(c,b){!c&&this._def_count&&this._def_count.firstChild&&(b||(new Date).valueOf()-this._def_count._created.valueOf()>500)&&(c=this._def_count.firstChild),c&&(c.onclick=null,c.innerHTML="",c.parentNode&&c.parentNode.removeChild(c),this._def_count&&(this._def_count.style.top="-1000px"),c.conf&&c.conf._on_xle_handler&&a.detachEvent(c.conf._on_xle_handler))},a.isCalendarVisible=function(){return this._def_count&&parseInt(this._def_count.style.top,10)>0?this._def_count:!1},a._attach_minical_events=function(){dhtmlxEvent(document.body,"click",function(){a.destroyCalendar()}),a._attach_minical_events=function(){}},a.attachEvent("onTemplatesReady",function(){a._attach_minical_events()}),a.templates.calendar_time=a.date.date_to_str("%d-%m-%Y"),a.form_blocks.calendar_time={render:function(){var e="<input class='dhx_readonly' type='text' readonly='true'>",b=a.config,j=this.date.date_part(a._currentDate()),c=1440,g=0;b.limit_time_select&&(g=60*b.first_hour,c=60*b.last_hour+1),j.setHours(g/60),e+=" <select>";for(var f=g;c>f;f+=1*this.config.time_step){var h=this.templates.time_picker(j);e+="<option value='"+f+"'>"+h+"</option>",j=this.date.add(j,this.config.time_step,"minute")}e+="</select>";a.config.full_day;return"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+e+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+e+"</div>"},set_value:function(x,q,f){function j(d,c,h){v(d,c,h),d.value=a.templates.calendar_time(c),d._date=a.date.date_part(new Date(c))}var b,y,m=x.getElementsByTagName("input"),e=x.getElementsByTagName("select"),v=function(d,c,h){d.onclick=function(){a.destroyCalendar(null,!0),a.renderCalendar({position:d,date:new Date(this._date),navigation:!0,handler:function(i){d.value=a.templates.calendar_time(i),d._date=new Date(i),a.destroyCalendar(),a.config.event_duration&&a.config.auto_end_date&&0===h&&w()}})}};if(a.config.full_day){if(!x._full_day){var g="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+a.locale.labels.full_day+"&nbsp;</label></input>";a.config.wide_form||(g=x.previousSibling.innerHTML+g),x.previousSibling.innerHTML=g,x._full_day=!0}var k=x.previousSibling.getElementsByTagName("input")[0],p=0===a.date.time_part(f.start_date)&&0===a.date.time_part(f.end_date);k.checked=p,e[0].disabled=k.checked,e[1].disabled=k.checked,k.onclick=function(){if(k.checked===!0){var d={};a.form_blocks.calendar_time.get_value(x,d),b=a.date.date_part(d.start_date),y=a.date.date_part(d.end_date),(+y==+b||+y>=+b&&(0!==f.end_date.getHours()||0!==f.end_date.getMinutes()))&&(y=a.date.add(y,1,"day"))}var h=b||f.start_date,c=y||f.end_date;j(m[0],h),j(m[1],c),e[0].value=60*h.getHours()+h.getMinutes(),e[1].value=60*c.getHours()+c.getMinutes(),e[0].disabled=k.checked,e[1].disabled=k.checked}}if(a.config.event_duration&&a.config.auto_end_date){var w=function(){b=a.date.add(m[0]._date,e[0].value,"minute"),y=new Date(b.getTime()+60*a.config.event_duration*1000),m[1].value=a.templates.calendar_time(y),m[1]._date=a.date.date_part(new Date(y)),e[1].value=60*y.getHours()+y.getMinutes()};e[0].onchange=w}j(m[0],f.start_date,0),j(m[1],f.end_date,1),v=function(){},e[0].value=60*f.start_date.getHours()+f.start_date.getMinutes(),e[1].value=60*f.end_date.getHours()+f.end_date.getMinutes()},get_value:function(d,b){var e=d.getElementsByTagName("input"),c=d.getElementsByTagName("select");return b.start_date=a.date.add(e[0]._date,c[0].value,"minute"),b.end_date=a.date.add(e[1]._date,c[1].value,"minute"),b.end_date<=b.start_date&&(b.end_date=a.date.add(b.start_date,a.config.time_step,"minute")),{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(){}},a.linkCalendar=function(c,b){var d=function(){var f=a._date,e=new Date(f.valueOf());return b&&(e=b(e)),e.setDate(1),a.updateCalendar(c,e),!0};a.attachEvent("onViewChange",d),a.attachEvent("onXLE",d),a.attachEvent("onEventAdded",d),a.attachEvent("onEventChanged",d),a.attachEvent("onAfterEventDelete",d),d()},a._markCalendarCurrentDate=function(e){var b=a._date,j=a._mode,c=a.date.month_start(new Date(e._date)),g=a.date.add(c,1,"month");if("day"==j||this._props&&this._props[j]){c.valueOf()<=b.valueOf()&&g>b&&a.markCalendar(e,b,"dhx_calendar_click")}else{if("week"==j){for(var f=a.date.week_start(new Date(b.valueOf())),h=0;7>h;h++){c.valueOf()<=f.valueOf()&&g>f&&a.markCalendar(e,f,"dhx_calendar_click"),f=a.date.add(f,1,"day")}}}},a.attachEvent("onEventCancel",function(){a.destroyCalendar(null,!0)})});